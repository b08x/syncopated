---
# tasks file for docker

- name: Docker Tasks
  ansible.builtin.debug:
    msg: "Starting docker tasks"

- name: Check if Docker is installed
  register: docker_check
  changed_when: false
  ignore_errors: true
  ansible.builtin.command: docker --version

- name: Print Docker version if installed
  when: docker_check.rc == 0
  ansible.builtin.debug:
    msg: "Docker version: {{ docker_check.msg }}"

- block:
  - import_tasks:
      file: debian.yml
    when: (ansible_os_family == 'Debian' or ansible_distribution == "Pop!_OS")

  when: docker_check.rc == 0
  tags: ["packages"]


- name: Ensure group "docker" exists
  ansible.builtin.group:
    name: docker
    state: present

#TODO: add failed_when logic

- name: Add user to docker group
  ignore_errors: "{{ ansible_check_mode }}"
  # register: dockergroup
  # failed_when: "not 'Group docker does not exist' in dockergroup.msg"
  tags:
  - groups
  ansible.builtin.user:
    name: "{{ user.name }}"
    groups: docker
    append: true
  # check_mode: yes

- tags:
  - setup
  ansible.builtin.import_tasks:
    file: setup.yml
